generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Achievement {
  id            String                @id @default(uuid())
  name          String
  description   String
  category      AchievementCategory
  type          String // STREAK_1W, STREAK_2W, RANK_SCHOOL_1, SCORE_400, FULL_MATH, etc.
  requirement   Json // { weeks: 1 } or { rank: 1, scope: 'SCHOOL' } or { score: 400 } etc.
  iconName      String // trophy, star, target, flame, award, medal, crown
  colorScheme   String // blue, orange, green, purple, yellow, red, gold
  points        Int                   @default(0)
  isActive      Boolean               @default(true)
  examType      ExamType? // TYT, AYT, LGS - for exam-specific achievements
  schoolId      String?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  school        School?               @relation(fields: [schoolId], references: [id])
  studentAchievements StudentAchievement[]

  @@unique([schoolId, type])
  @@index([schoolId, isActive])
  @@index([category, isActive])
}

model StudentAchievement {
  id            String      @id @default(uuid())
  studentId     String
  achievementId String
  progress      Float       @default(0) // 0-100 percentage
  unlockedAt    DateTime?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  schoolId      String?
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  school        School?     @relation(fields: [schoolId], references: [id])
  student       Student     @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, achievementId])
  @@index([studentId, unlockedAt])
  @@index([achievementId])
  @@index([schoolId])
}

model Backup {
  id        String   @id @default(uuid())
  filename  String
  size      Int
  schoolId  String
  createdAt DateTime @default(now())
  data      String?
  school    School   @relation(fields: [schoolId], references: [id])

  @@index([schoolId])
}

model Class {
  id       String    @id @default(uuid())
  name     String
  gradeId  String
  schoolId String
  grade    Grade     @relation(fields: [gradeId], references: [id])
  school   School    @relation(fields: [schoolId], references: [id])
  messages Message[]
  students Student[]
  mentorGroups MentorGroup[]

  @@unique([schoolId, gradeId, name])
}

model Exam {
  id                       String             @id @default(uuid())
  title                    String
  type                     ExamType
  date                     DateTime           @default(now())
  schoolId                 String
  createdAt                DateTime           @default(now())
  updatedAt          DateTime             @updatedAt
  branchParticipantCount   Json?
  city                     String?
  district                 String?
  generalInfo              String?
  gradeLevel               Int
  participantCount         Int?
  publisher                String?
  schoolParticipantCount   Int?
  cityParticipantCount     Int?
  districtParticipantCount Int?
  generalParticipantCount  Int?
  answerKeyUrl             String?
  applicationDateTime      DateTime?
  broughtBy                String?
  color                    String?
  fee                      Float?
  isAnswerKeyPublic        Boolean            @default(false)
  isArchived               Boolean            @default(false)
  isPaid                   Boolean            @default(false)
  isPublished              Boolean            @default(true)
  isPublisherVisible       Boolean            @default(false)
  quantity                 Int?
  scheduledDateTime        DateTime?
  school                   School             @relation(fields: [schoolId], references: [id])
  attempts                 ExamAttempt[]
  notifications            ExamNotification[]

  @@index([schoolId, gradeLevel, date])
  @@index([schoolId, isArchived, isPublished])
}

model ExamAttempt {
  id               String             @id @default(uuid())
  examId           String
  studentId        String
  createdAt        DateTime           @default(now())
  schoolId         String?
  exam             Exam               @relation(fields: [examId], references: [id], onDelete: Cascade)
  school           School?            @relation(fields: [schoolId], references: [id])
  student          Student            @relation(fields: [studentId], references: [id])
  lessonResults    ExamLessonResult[]
  scores           ExamScore[]

  @@unique([examId, studentId])
}

model ExamCalendarSettings {
  id                    String   @id @default(uuid())
  schoolId              String   @unique
  showPublisher         Boolean  @default(false)
  showBroughtBy         Boolean  @default(false)
  showFee               Boolean  @default(false)
  showParticipantCounts Boolean  @default(true)
  notifyDaysBefore      Int      @default(3)
  autoPublishDaysAfter  Int      @default(0)
  defaultView           String   @default("table")
  academicYearStart     Int      @default(6)
  createdAt             DateTime @default(now())
  updatedAt          DateTime             @updatedAt

  @@index([schoolId])
}

model ExamLessonResult {
  id          String      @id @default(uuid())
  attemptId   String
  lessonId    String
  correct     Int         @default(0)
  incorrect   Int         @default(0)
  empty       Int         @default(0)
  net         Float       @default(0)
  point       Float       @default(0)
  schoolId    String?
  attempt     ExamAttempt @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  lesson      Lesson      @relation(fields: [lessonId], references: [id])
  school      School?     @relation(fields: [schoolId], references: [id])
}

model ExamNotification {
  id               String    @id @default(uuid())
  examId           String
  notificationType String
  scheduledFor     DateTime
  sentAt           DateTime?
  isSent           Boolean   @default(false)
  messageId        String?
  createdAt        DateTime  @default(now())
  exam             Exam      @relation(fields: [examId], references: [id], onDelete: Cascade)

  @@index([examId, isSent])
  @@index([scheduledFor, isSent])
}

model ExamScore {
  id          String      @id @default(uuid())
  attemptId   String
  type        String
  score       Float
  rankSchool  Int?
  rankClass   Int?
  rankDistrict Int?
  rankCity    Int?
  rankGen     Int?
  schoolId    String?
  attempt     ExamAttempt @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  school      School?     @relation(fields: [schoolId], references: [id])
}

model Grade {
  id       String    @id @default(uuid())
  name     String
  schoolId String
  classes  Class[]
  school   School    @relation(fields: [schoolId], references: [id])
  messages Message[]
  mentorGroups MentorGroup[]

  @@unique([schoolId, name])
}

model GroupGoal {
  id          String      @id @default(uuid())
  groupId     String
  goalType    String
  targetData  Json
  deadline    DateTime?
  isActive    Boolean     @default(true)
  isPublished Boolean     @default(true)
  isCompleted Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt          DateTime             @updatedAt
  schoolId    String
  group       MentorGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  school      School      @relation(fields: [schoolId], references: [id])
  posts       GroupPost[]

  @@index([groupId, isActive])
  @@index([schoolId])
}

model GroupPost {
  id        String         @id @default(uuid())
  groupId   String
  schoolId  String
  authorId  String
  type      GroupPostType
  title     String?
  body      String?
  filePath  String?
  fileName  String?
  fileSize  Int?
  mimeType  String?
  goalId    String?
  planId    String?
  data      Json?
  isPinned  Boolean        @default(false)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  group  MentorGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  school School      @relation(fields: [schoolId], references: [id])
  author User        @relation(fields: [authorId], references: [id])
  goal   GroupGoal?  @relation(fields: [goalId], references: [id], onDelete: SetNull)
  plan   StudyPlan?  @relation(fields: [planId], references: [id], onDelete: SetNull)
  replies    GroupPostReply[]
  responses  GroupPostResponse[]

  @@index([groupId, createdAt])
  @@index([schoolId, createdAt])
}

model GroupPostReply {
  id        String   @id @default(uuid())
  postId    String
  authorId  String
  body      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post   GroupPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  author User      @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([postId, createdAt])
  @@index([authorId])
}

model GroupPostResponse {
  id             String   @id @default(uuid())
  postId         String
  studentId      String
  selectedOption String
  isCorrect      Boolean?
  pointsAwarded  Int      @default(0)
  createdAt      DateTime @default(now())

  post    GroupPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  student Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([postId, studentId])
  @@index([postId, createdAt])
  @@index([studentId])
}

model GroupMembership {
  id          String          @id @default(uuid())
  groupId     String
  studentId   String
  role        GroupMemberRole @default(MEMBER)
  joinedAt    DateTime        @default(now())
  leftAt      DateTime?
  schoolId    String
  group       MentorGroup     @relation(fields: [groupId], references: [id], onDelete: Cascade)
  school      School          @relation(fields: [schoolId], references: [id])
  student     Student         @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([groupId, studentId])
  @@index([groupId, leftAt])
  @@index([schoolId])
  @@index([studentId])
}

model GroupStudyPlan {
  id          String      @id @default(uuid())
  groupId     String
  studyPlanId String
  assignedAt  DateTime    @default(now())
  group       MentorGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  studyPlan   StudyPlan   @relation(fields: [studyPlanId], references: [id], onDelete: Cascade)

  @@unique([groupId, studyPlanId])
  @@index([groupId])
}

model Lesson {
  id               String             @id @default(uuid())
  name             String
  examType         ExamType
  schoolId         String
  examLessonResults ExamLessonResult[]
  school           School             @relation(fields: [schoolId], references: [id])

  @@unique([name, examType, schoolId])
}

model MentorGroup {
  id              String            @id @default(uuid())
  teacherId       String?
  schoolId        String
  name            String
  description     String?
  gradeIds        Json              @default("[]")
  maxStudents     Int               @default(25)
  isActive        Boolean           @default(true)
  coverImage      String?
  groupType       GroupType         @default(MENTOR)
  gradeId         String?
  classId         String?
  createdAt       DateTime          @default(now())
  updatedAt          DateTime             @updatedAt
  goals           GroupGoal[]
  posts           GroupPost[]
  memberships     GroupMembership[]
  groupPlans      GroupStudyPlan[]
  school          School            @relation(fields: [schoolId], references: [id])
  teacher         User?             @relation(fields: [teacherId], references: [id], onDelete: SetNull)
  grade           Grade?            @relation(fields: [gradeId], references: [id])
  class           Class?            @relation(fields: [classId], references: [id])
  messages        Message[]

  @@index([isActive])
  @@index([teacherId, schoolId])
  @@index([schoolId, groupType])
}

model Message {
  id                String              @id @default(uuid())
  senderId          String
  subject           String
  body              String
  type              MessageType         @default(DIRECT)
  category          MessageCategory     @default(GENERAL)
  status            MessageStatus       @default(SENT)
  targetRoles       Json?
  targetGradeId     String?
  targetClassId     String?
  scheduledFor      DateTime?
  sentAt            DateTime?
  requiresApproval  Boolean             @default(false)
  approvedBy        String?
  approvedAt        DateTime?
  schoolId          String
  createdAt         DateTime            @default(now())
  updatedAt          DateTime             @updatedAt
  deletedAt         DateTime?
  allowReplies      Boolean             @default(true)
  groupId           String?
  group             MentorGroup?        @relation(fields: [groupId], references: [id])
  school            School              @relation(fields: [schoolId], references: [id], onDelete: Cascade)
  sender            User                @relation(fields: [senderId], references: [id], onDelete: Cascade)
  targetClass       Class?              @relation(fields: [targetClassId], references: [id])
  targetGrade       Grade?              @relation(fields: [targetGradeId], references: [id])
  attachments       MessageAttachment[]
  recipients        MessageRecipient[]
  replies           MessageReply[]

  @@index([deletedAt])
  @@index([schoolId, sentAt])
  @@index([senderId, status])
  @@index([status, scheduledFor])
}

model MessageAttachment {
  id        String   @id @default(uuid())
  messageId String
  filename  String
  fileUrl   String
  fileSize  Int
  mimeType  String
  createdAt DateTime @default(now())
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}

model MessageDraft {
  id            String          @id @default(uuid())
  userId        String
  subject       String?
  body          String?
  category      MessageCategory @default(GENERAL)
  targetRoles   Json?
  targetGradeId String?
  targetClassId String?
  recipientIds  Json?
  schoolId      String
  createdAt     DateTime        @default(now())
  updatedAt          DateTime             @updatedAt
  allowReplies  Boolean         @default(true)
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, schoolId])
}

model MessageRecipient {
  id          String    @id @default(uuid())
  messageId   String
  recipientId String
  isRead      Boolean   @default(false)
  readAt      DateTime?
  deliveredAt DateTime  @default(now())
  deletedAt   DateTime?
  createdAt   DateTime  @default(now())
  isFavorite  Boolean   @default(false)
  message     Message   @relation(fields: [messageId], references: [id], onDelete: Cascade)
  recipient   User      @relation(fields: [recipientId], references: [id], onDelete: Cascade)

  @@unique([messageId, recipientId])
  @@index([recipientId, deletedAt])
  @@index([recipientId, isRead])
}

model MessageReply {
  id        String    @id @default(uuid())
  messageId String
  senderId  String
  body      String
  createdAt DateTime  @default(now())
  deletedAt DateTime?
  message   Message   @relation(fields: [messageId], references: [id], onDelete: Cascade)
  sender    User      @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([messageId, createdAt])
}

model MessageSettings {
  id                       String   @id @default(uuid())
  schoolId                 String   @unique
  maxCharacterLimit        Int      @default(1000)
  autoDeleteDays           Int      @default(30)
  requireTeacherApproval   Boolean  @default(false)
  enableEmailNotifications Boolean  @default(true)
  enablePushNotifications  Boolean  @default(true)
  reminderAfterDays        Int      @default(3)
  createdAt                DateTime @default(now())
  updatedAt          DateTime             @updatedAt

  @@index([schoolId])
}

model MessageTemplate {
  id        String          @id @default(uuid())
  name      String
  subject   String
  body      String
  category  MessageCategory
  schoolId  String
  createdAt DateTime        @default(now())
  updatedAt          DateTime             @updatedAt

  @@index([schoolId])
}

model Parent {
  id       String    @id @default(uuid())
  userId   String    @unique
  user     User      @relation(fields: [userId], references: [id])
  students Student[]
}

model PasswordResetToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  used      Boolean  @default(false)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model Resource {
  id                String          @id @default(uuid())
  name              String
  type              ResourceType    @default(BOOK)
  publisherOrAuthor String?
  examType          ExamType?
  subjectName       String?
  isPopular         Boolean         @default(false)
  createdAt         DateTime        @default(now())
  updatedAt          DateTime             @updatedAt
  topicResources    TopicResource[]

  @@unique([examType, subjectName, name])
  @@index([examType, subjectName])
  @@index([isPopular])
}

model School {
  id                        String                      @id @default(uuid())
  name                      String
  code                      String                      @unique
  logoUrl                   String?
  domain                    String?                     @unique
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  address                   String?
  isParentLoginActive       Boolean                     @default(true)
  phone                     String?
  studentLoginType          String                      @default("studentNumber")
  website                   String?
  
  // Study Plan Cleanup Settings
  autoCleanupEnabled        Boolean                     @default(true)
  cleanupMonthsToKeep       Int                         @default(1)
  lastCleanupAt             DateTime?
  
  backups                   Backup[]
  classes                   Class[]
  exams                     Exam[]
  examAttempts              ExamAttempt[]
  examLessonResults         ExamLessonResult[]
  examScores                ExamScore[]
  grades                    Grade[]
  groupGoals                GroupGoal[]
  groupMemberships          GroupMembership[]
  lessons                   Lesson[]
  mentorGroups              MentorGroup[]
  messages                  Message[]
  students                  Student[]
  studentPerformanceSummaries StudentPerformanceSummary[]
  studyPlans                StudyPlan[]
  studyPlanAssignments      StudyPlanAssignment[]
  studyPlanTemplates        StudyPlanTemplate[]
  studyRecommendations      StudyRecommendation[]
  studySessions             StudySession[]
  studyTasks                StudyTask[]
  users                     User[]
  achievements              Achievement[]
  studentAchievements       StudentAchievement[]
  groupPosts                GroupPost[]
}

model Student {
  id                   String                      @id @default(uuid())
  studentNumber        String?
  userId               String                      @unique
  classId              String
  schoolId             String
  parentId             String?
  tcNo                 String?                     @unique
  rewardPoints         Int                         @default(0)
  examAttempts         ExamAttempt[]
  groupMemberships     GroupMembership[]
  class                Class                       @relation(fields: [classId], references: [id])
  parent               Parent?                     @relation(fields: [parentId], references: [id])
  school               School                      @relation(fields: [schoolId], references: [id])
  user                 User                        @relation(fields: [userId], references: [id])
  performanceSummaries StudentPerformanceSummary[]
  recommendations      StudyRecommendation[]
  sessions             StudySession[]
  tasks                StudyTask[]
  achievements         StudentAchievement[]
  groupPostResponses   GroupPostResponse[]
}

model StudentPerformanceSummary {
  id                 String     @id @default(uuid())
  studentId          String
  schoolId           String
  year               Int?
  month              Int?
  weekNumber         Int?
  totalTasks         Int        @default(0)
  completedTasks     Int        @default(0)
  totalQuestions     Int        @default(0)
  completedQuestions Int        @default(0)
  correctCount       Int        @default(0)
  wrongCount         Int        @default(0)
  blankCount         Int        @default(0)
  totalDuration      Int        @default(0)
  completionRate     Float      @default(0)
  planName           String?
  examType           ExamType?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime             @updatedAt
  planId             String?
  plan               StudyPlan? @relation(fields: [planId], references: [id])
  school             School     @relation(fields: [schoolId], references: [id])
  student            Student    @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, planId])
  @@index([schoolId])
  @@index([studentId])
  @@index([planId])
}

model StudyPlan {
  id                   String                      @id @default(uuid())
  teacherId            String
  schoolId             String
  name                 String
  description          String?
  targetType           StudyPlanTargetType?
  targetId             String?
  isTemplate           Boolean                     @default(true)
  createdAt            DateTime                    @default(now())
  updatedAt          DateTime             @updatedAt
  examType             String?
  gradeLevels          Int[]
  planData             Json
  status               StudyPlanStatus             @default(DRAFT)
  templateName         String?
  weekStartDate        DateTime?
  isShared             Boolean                     @default(false)
  sharedAt             DateTime?
  deletedAt            DateTime?
  endDate              DateTime?
  isPublic             Boolean                     @default(false)
  startDate            DateTime?
  groupPlans           GroupStudyPlan[]
  performanceSummaries StudentPerformanceSummary[]
  school               School                      @relation(fields: [schoolId], references: [id])
  teacher              User                        @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  assignments          StudyPlanAssignment[]
  tasks                StudyTask[]
  groupPosts           GroupPost[]

  @@index([examType, gradeLevels])
  @@index([isShared])
  @@index([isTemplate])
  @@index([status])
  @@index([teacherId, schoolId])
  @@index([deletedAt])
}

model StudyPlanAssignment {
  id             String               @id @default(uuid())
  schoolId       String
  assignedById   String
  targetType     AssignmentTargetType
  targetId       String
  customPlanData Json?
  year           Int?
  month          Int?
  weekNumber     Int?
  status         StudyPlanStatus      @default(ASSIGNED)
  expiresAt      DateTime?
  createdAt      DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  endDate        DateTime?
  planId         String
  startDate      DateTime?
  assignedBy     User                 @relation(fields: [assignedById], references: [id])
  plan           StudyPlan            @relation(fields: [planId], references: [id], onDelete: Cascade)
  school         School               @relation(fields: [schoolId], references: [id])
  tasks          StudyTask[]

  @@index([assignedById])
  @@index([expiresAt])
  @@index([schoolId])
  @@index([status])
  @@index([targetType, targetId])
  @@index([planId])
}

model StudyPlanTemplate {
  id             String           @id @default(uuid())
  name           String
  description    String?
  authorId       String
  schoolId       String
  examType       ExamType
  gradeLevel     String
  durationWeeks  Int
  isPublic       Boolean          @default(false)
  isOfficial     Boolean          @default(false)
  tags           Json
  planData       Json
  usageCount     Int              @default(0)
  averageRating  Float            @default(0)
  createdAt      DateTime         @default(now())
  updatedAt          DateTime             @updatedAt
  author         User             @relation(fields: [authorId], references: [id], onDelete: Cascade)
  school         School           @relation(fields: [schoolId], references: [id])
  ratings        TemplateRating[]

  @@index([authorId])
  @@index([examType, isPublic])
  @@index([schoolId])
}

model StudyRecommendation {
  id                 String             @id @default(uuid())
  studentId          String
  schoolId           String
  recommendationType RecommendationType
  subjectName        String?
  topicId            String?
  reasoning          String
  priority           Int                @default(5)
  estimatedTime      Int?
  isCompleted        Boolean            @default(false)
  completedAt        DateTime?
  createdAt          DateTime           @default(now())
  expiresAt          DateTime?
  school             School             @relation(fields: [schoolId], references: [id])
  student            Student            @relation(fields: [studentId], references: [id], onDelete: Cascade)
  topic              Topic?             @relation(fields: [topicId], references: [id])

  @@index([createdAt])
  @@index([schoolId])
  @@index([studentId, isCompleted])
}

model StudySession {
  id             String   @id @default(uuid())
  studentId      String
  schoolId       String
  subjectName    String
  topicId        String?
  startTime      DateTime
  endTime        DateTime
  duration       Int
  isPomodoroMode Boolean  @default(false)
  createdAt      DateTime @default(now())
  school         School   @relation(fields: [schoolId], references: [id])
  student        Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  topic          Topic?   @relation(fields: [topicId], references: [id])

  @@index([schoolId])
  @@index([studentId, startTime])
}

model StudyTask {
  id                     String               @id @default(uuid())
  planId                 String?
  studentId              String
  schoolId               String
  subjectName            String
  status                 StudyTaskStatus      @default(PENDING)
  teacherComment         String?
  parentComment          String?
  createdAt              DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  rowIndex               Int                  @default(0)
  dayIndex               Int                  @default(0)
  topicName              String?
  targetQuestionCount    Int?
  targetDuration         Int?
  targetResource         String?
  completedQuestionCount Int                  @default(0)
  actualDuration         Int                  @default(0)
  correctCount           Int                  @default(0)
  wrongCount             Int                  @default(0)
  blankCount             Int                  @default(0)
  actualResource         String?
  studentNotes           String?
  customContent          String?
  completedAt            DateTime?
  parentApproved         Boolean              @default(false)
  parentApprovedAt       DateTime?
  parentId               String?
  teacherApproved        Boolean              @default(false)
  teacherApprovedAt      DateTime?
  teacherApprovedById    String?
  assignmentId           String?
  dueDate                DateTime?
  assignment             StudyPlanAssignment? @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  plan                   StudyPlan?           @relation(fields: [planId], references: [id])
  school                 School               @relation(fields: [schoolId], references: [id])
  student                Student              @relation(fields: [studentId], references: [id], onDelete: Cascade)
  teacherApprovedBy      User?                @relation(fields: [teacherApprovedById], references: [id])

  @@unique([assignmentId, studentId, rowIndex, dayIndex])
  @@index([assignmentId])
  @@index([planId])
  @@index([schoolId])
  @@index([studentId, status])
  @@index([dueDate])
}

model Subject {
  id          String   @id @default(uuid())
  name        String
  examType    String
  gradeLevels Int[]
  order       Int      @default(0)
  type        String   @default("NORMAL") // NORMAL, EXAM, PRACTICE, REVIEW
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt          DateTime             @updatedAt
  topics      Topic[]

  @@index([examType])
  @@index([isActive])
}

model TemplateRating {
  id                String            @id @default(uuid())
  templateId        String
  userId            String
  rating            Int
  comment           String?
  createdAt         DateTime          @default(now())
  template          StudyPlanTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([templateId, userId])
  @@index([templateId])
}

model Topic {
  id                  String                @id @default(uuid())
  name                String
  parentTopicId       String?
  order               Int                   @default(0)
  isSpecialActivity   Boolean               @default(false)
  createdAt           DateTime              @default(now())
  updatedAt          DateTime             @updatedAt
  subjectId           String?
  studyRecommendations StudyRecommendation[]
  studySessions       StudySession[]
  parentTopic         Topic?                @relation("TopicToTopic", fields: [parentTopicId], references: [id])
  childTopics         Topic[]               @relation("TopicToTopic")
  subject             Subject?              @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  topicResources      TopicResource[]

  @@index([parentTopicId])
  @@index([subjectId])
}

model TopicResource {
  id         String   @id @default(uuid())
  topicId    String
  resourceId String
  createdAt  DateTime @default(now())
  resource   Resource @relation(fields: [resourceId], references: [id], onDelete: Cascade)
  topic      Topic    @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@unique([topicId, resourceId])
  @@index([resourceId])
  @@index([topicId])
}

model User {
  id                   String                @id @default(uuid())
  email                String?               @unique
  password             String
  role                 Role                  @default(STUDENT)
  firstName            String
  lastName             String
  schoolId             String
  createdAt            DateTime              @default(now())
  updatedAt          DateTime             @updatedAt
  avatarSeed           String?
  branch               String?
  mentorGroups         MentorGroup[]
  messages             Message[]
  messageDrafts        MessageDraft[]
  messageRecipients    MessageRecipient[]
  messageReplies       MessageReply[]
  parent               Parent?
  passwordResetTokens  PasswordResetToken[]
  student              Student?
  studyPlans           StudyPlan[]
  studyPlanAssignments StudyPlanAssignment[]
  studyPlanTemplates   StudyPlanTemplate[]
  approvedTasks        StudyTask[]
  templateRatings      TemplateRating[]
  school               School                @relation(fields: [schoolId], references: [id])
  groupPosts           GroupPost[]
  groupPostReplies     GroupPostReply[]
}

enum AchievementCategory {
  STREAK
  MILESTONE
  IMPROVEMENT
  GROUP
  CONSISTENCY
}

enum AssignmentTargetType {
  STUDENT
  GROUP
  GRADE
  CLASS
}

enum ExamType {
  TYT
  AYT
  LGS
  OZEL
}

enum GroupMemberRole {
  MEMBER
  CO_LEADER
}

enum GroupPostType {
  ANNOUNCEMENT
  FILE
  GOAL
  PLAN
  POLL
  VIDEO
  QUESTION
}

enum GroupType {
  MENTOR
  CLASS
  GRADE
}

enum MessageCategory {
  GENERAL
  EXAM
  URGENT
  ANNOUNCEMENT
  GROUP
}

enum MessageStatus {
  DRAFT
  SCHEDULED
  SENT
  DELETED
}

enum MessageType {
  DIRECT
  BROADCAST
  SCHEDULED
}

enum RecommendationType {
  TEACHER_ASSIGNMENT
  WEAK_AREA
  STUDY_GAP
  DIFFICULTY_BALANCE
  EXAM_PREP
}

enum ResourceType {
  BOOK
  VIDEO
  ARTICLE
  ONLINE_COURSE
}

enum Role {
  SUPER_ADMIN
  SCHOOL_ADMIN
  TEACHER
  STUDENT
  PARENT
}

enum StudyPlanStatus {
  DRAFT
  ASSIGNED
  ACTIVE
  COMPLETED
  CANCELLED
  ARCHIVED
}

enum StudyPlanTargetType {
  INDIVIDUAL
  GROUP
}

enum StudyTaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  MISSED
  LATE
}

enum TopicDifficulty {
  EASY
  MEDIUM
  HARD
}
